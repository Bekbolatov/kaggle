9node m3 cluster
SPARK_REPL_OPTS="-XX:+CMSClassUnloadingEnabled -XX:MaxPermSize=712m -Xmx=8g" spark-shell --jars AvitoProject-assembly-1.0.jar

spark.shuffle.blockTransferService    nio
spark.serializer org.apache.spark.serializer.KryoSerializer



    at java.nio.HeapByteBuffer.<init>(HeapByteBuffer.java:57)
        at java.nio.ByteBuffer.allocate(ByteBuffer.java:331)
        at org.apache.spark.network.BlockTransferService$$anon$1.onBlockFetchSuccess(BlockTransferService.scala:95)
        at org.apache.spark.network.nio.NioBlockTransferService$$anonfun$fetchBlocks$1$$anonfun$applyOrElse$3.apply(NioBlockTransferService.scala:118)
        at org.apache.spark.network.nio.NioBlockTransferService$$anonfun$fetchBlocks$1$$anonfun$applyOrElse$3.apply(NioBlockTransferService.scala:108)
        at scala.collection.TraversableLike$WithFilter$$anonfun$foreach$1.apply(TraversableLike.scala:772)
        at scala.collection.Iterator$class.foreach(Iterator.scala:727)
        at scala.collection.AbstractIterator.foreach(Iterator.scala:1157)
        at scala.collection.IterableLike$class.foreach(IterableLike.scala:72)
        at org.apache.spark.network.nio.BlockMessageArray.foreach(BlockMessageArray.scala:28)
        at scala.collection.TraversableLike$WithFilter.foreach(TraversableLike.scala:771)
        at org.apache.spark.network.nio.NioBlockTransferService$$anonfun$fetchBlocks$1.applyOrElse(NioBlockTransferService.scala:108)
        at org.apache.spark.network.nio.NioBlockTransferService$$anonfun$fetchBlocks$1.applyOrElse(NioBlockTransferService.scala:98)
        at scala.concurrent.Future$$anonfun$onSuccess$1.apply(Future.scala:117)
        at scala.concurrent.Future$$anonfun$onSuccess$1.apply(Future.scala:115)
        at scala.concurrent.impl.CallbackRunnable.run(Promise.scala:32)
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)
        at java.lang.Thread.run(Thread.java:745)
Exception in thread "Connection manager future execution context-2" java.lang.OutOfMemoryError: Java heap space
        at java.nio.HeapByteBuffer.<init>(HeapByteBuffer.java:57)
        at java.nio.ByteBuffer.allocate(ByteBuffer.java:331)
        at org.apache.spark.network.BlockTransferService$$anon$1.onBlockFetchSuccess(BlockTransferService.scala:95)
        at org.apache.spark.network.nio.NioBlockTransferService$$anonfun$fetchBlocks$1$$anonfun$applyOrElse$3.apply(NioBlockTransferService.scala:118)
        at org.apache.spark.network.nio.NioBlockTransferService$$anonfun$fetchBlocks$1$$anonfun$applyOrElse$3.apply(NioBlockTransferService.scala:108)
        at scala.collection.TraversableLike$WithFilter$$anonfun$foreach$1.apply(TraversableLike.scala:772)
        at scala.collection.Iterator$class.foreach(Iterator.scala:727)
        at scala.collection.AbstractIterator.foreach(Iterator.scala:1157)
        at scala.collection.IterableLike$class.foreach(IterableLike.scala:72)
        at org.apache.spark.network.nio.BlockMessageArray.foreach(BlockMessageArray.scala:28)
        at scala.collection.TraversableLike$WithFilter.foreach(TraversableLike.scala:771)
        at org.apache.spark.network.nio.NioBlockTransferService$$anonfun$fetchBlocks$1.applyOrElse(NioBlockTransferService.scala:108)
        at org.apache.spark.network.nio.NioBlockTransferService$$anonfun$fetchBlocks$1.applyOrElse(NioBlockTransferService.scala:98)
        at scala.concurrent.Future$$anonfun$onSuccess$1.apply(Future.scala:117)
        at scala.concurrent.Future$$anonfun$onSuccess$1.apply(Future.scala:115)
        at scala.concurrent.impl.CallbackRunnable.run(Promise.scala:32)
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)
        at java.lang.Thread.run(Thread.java:745)
Exception in thread "Connection manager future execution context-0" java.lang.OutOfMemoryError: Java heap space
        at java.nio.HeapByteBuffer.<init>(HeapByteBuffer.java:57)
        at java.nio.ByteBuffer.allocate(ByteBuffer.java:331)
        at org.apache.spark.network.BlockTransferService$$anon$1.onBlockFetchSuccess(BlockTransferService.scala:95)
        at org.apache.spark.network.nio.NioBlockTransferService$$anonfun$fetchBlocks$1$$anonfun$applyOrElse$3.apply(NioBlockTransferService.scala:118)
        at org.apache.spark.network.nio.NioBlockTransferService$$anonfun$fetchBlocks$1$$anonfun$applyOrElse$3.apply(NioBlockTransferService.scala:108)
        at scala.collection.TraversableLike$WithFilter$$anonfun$foreach$1.apply(TraversableLike.scala:772)
        at scala.collection.Iterator$class.foreach(Iterator.scala:727)
        at scala.collection.AbstractIterator.foreach(Iterator.scala:1157)
        at scala.collection.IterableLike$class.foreach(IterableLike.scala:72)
        at org.apache.spark.network.nio.BlockMessageArray.foreach(BlockMessageArray.scala:28)
        at scala.collection.TraversableLike$WithFilter.foreach(TraversableLike.scala:771)
        at org.apache.spark.network.nio.NioBlockTransferService$$anonfun$fetchBlocks$1.applyOrElse(NioBlockTransferService.scala:108)
        at org.apache.spark.network.nio.NioBlockTransferService$$anonfun$fetchBlocks$1.applyOrElse(NioBlockTransferService.scala:98)
        at scala.concurrent.Future$$anonfun$onSuccess$1.apply(Future.scala:117)
        at scala.concurrent.Future$$anonfun$onSuccess$1.apply(Future.scala:115)
        at scala.concurrent.impl.CallbackRunnable.run(Promise.scala:32)
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)
        at java.lang.Thread.run(Thread.java:745)

